import { Injectable } from '@angular/core';
import { PresetColors } from 'ngx-eagle/core/types';
import * as i0 from "@angular/core";
export class ColorConverter {
    constructor() { }
    //--------------START VALIDATIONS ------------------
    isPresetColors(presetColors) {
        if (!presetColors)
            throw new TypeError(`Invalid argument; has no value.`);
        PresetColors[presetColors.toLowerCase()];
        return PresetColors[presetColors.toLowerCase()] ? true : false;
    }
    isHex(hex) {
        if (!hex)
            throw new TypeError(`Invalid argument; has no value.`);
        const regex = /^#(?:[0-9a-fA-F]{3}){1,2}$/;
        return regex.test(hex);
    }
    isRGB(rgb) {
        if (!rgb)
            throw new TypeError(`Invalid argument; has no value.`);
        const regex = /^rgb\(\s*(0*(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*,\s*(0*(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*,\s*(0*(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*\)$/;
        return regex.test(rgb);
    }
    isRGBA(rgba) {
        if (!rgba)
            throw new TypeError(`Invalid argument; has no value.`);
        const regex = /^rgba\(\s*((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|0)\s*,\s*((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|0)\s*,\s*((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|0)\s*,\s*((1(\.0)?)|0(\.\d+)?)\s*\)$/;
        return regex.test(rgba);
    }
    isHSL(hsl) {
        if (!hsl)
            throw new TypeError(`Invalid argument; has no value.`);
        const regex = /^hsl\(\s*((\d{1,2}|[1-2]\d{2}|3[0-5]\d)|360)\s*,\s*(\d{1,2}|100)%\s*,\s*(\d{1,2}|100)%\s*\)$/;
        return regex.test(hsl);
    }
    isHSLA(hsla) {
        if (!hsla)
            throw new TypeError(`Invalid argument; has no value.`);
        const regex = /^hsla\(\s*((\d{1,2}|[1-2]\d{2}|3[0-5]\d)|360)\s*,\s*(\d{1,2}|100)%\s*,\s*(\d{1,2}|100)%\s*,\s*(0(\.\d+)?|1(\.0)?)\s*\)$/;
        return regex.test(hsla);
    }
    //--------------END VALIDATIONS ------------------
    contrastingColors(color) {
        let rgb;
        if (this.isPresetColors(color)) {
            rgb = this.hexToRgb(this.nameSVGToHex(color));
        }
        if (this.isHex(color)) {
            rgb = this.hexToRgb(color);
        }
        if (this.isRGB(color)) {
            rgb = this.rgbToObject(color);
        }
        if (this.isRGBA(color)) {
            rgb = this.rgbaToObject(color);
        }
        if (this.isHSL(color)) {
            rgb = this.hslToRgb(color);
        }
        if (this.isHSLA(color)) {
            rgb = this.hslaToRgb(color);
        }
        const buildOverlayColor = () => {
            const luminance = this.luminance(rgb);
            return luminance > 0.5 ? this.changeRgbLuminance(rgb, 0.35) : '#ffffff';
        };
        const backgroundColor = color;
        const overlayColor = buildOverlayColor();
        return { backgroundColor: backgroundColor, overlayColor: overlayColor };
    }
    changeRgbLuminance(rgb, luminance) {
        const newR = Math.max(0, Math.floor(rgb.r * luminance));
        const newG = Math.max(0, Math.floor(rgb.g * luminance));
        const newB = Math.max(0, Math.floor(rgb.b * luminance));
        return `rgb(${newR},${newG},${newB})`;
    }
    luminance(color) {
        return (0.299 * color.r + 0.587 * color.g + 0.114 * color.b) / 255;
    }
    //------------- TO RGB -------------
    rgbToObject(rgb) {
        if (!rgb)
            throw new TypeError(`Invalid argument; has no value.`);
        const match = rgb.match(/^rgb\(\s*(0*(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*,\s*(0*(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*,\s*(0*(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*\)$/);
        if (!match)
            throw new TypeError(`Invalid RGB color format: ${rgb}`);
        return {
            r: parseInt(match[1]),
            g: parseInt(match[2]),
            b: parseInt(match[3]),
        };
    }
    rgbaToObject(rgba) {
        if (!rgba)
            throw new TypeError(`Invalid argument; has no value.`);
        const match = rgba.match(/^rgba\(\s*((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|0)\s*,\s*((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|0)\s*,\s*((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|0)\s*,\s*((1(\.0)?)|0(\.\d+)?)\s*\)$/);
        if (!match)
            throw new TypeError(`Invalid RGBA color format: ${rgba}`);
        const r = parseInt(match[1]);
        const g = parseInt(match[3]);
        const b = parseInt(match[5]);
        const a = parseFloat(match[7]);
        // Convertir el color con opacidad a RGB
        const rgb = {
            r: Math.round((1 - a) * 255 + a * r),
            g: Math.round((1 - a) * 255 + a * g),
            b: Math.round((1 - a) * 255 + a * b),
        };
        return rgb;
    }
    hexToRgb(hex) {
        let hexCode = hex.startsWith('#') ? hex.slice(1) : hex;
        if (hexCode.length === 3) {
            hexCode = hexCode
                .split('')
                .map((char) => char + char)
                .join('');
        }
        const bigint = parseInt(hexCode, 16);
        const r = (bigint >> 16) & 255;
        const g = (bigint >> 8) & 255;
        const b = bigint & 255;
        return { r, g, b };
    }
    hslToRgb(hsl) {
        if (!hsl)
            throw new TypeError(`Invalid argument; has no value.`);
        const match = hsl.match(/^hsl\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)$/);
        if (!match)
            throw new TypeError(`Invalid HSL color format: ${hsl}`);
        const h = parseInt(match[1]) / 360;
        const s = parseInt(match[2]) / 100;
        const l = parseInt(match[3]) / 100;
        let r, g, b;
        if (s === 0) {
            r = g = b = l; // Achromatic
        }
        else {
            const hue2rgb = (p, q, t) => {
                if (t < 0)
                    t += 1;
                if (t > 1)
                    t -= 1;
                if (t < 1 / 6)
                    return p + (q - p) * 6 * t;
                if (t < 1 / 2)
                    return q;
                if (t < 2 / 3)
                    return p + (q - p) * (2 / 3 - t) * 6;
                return p;
            };
            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            const p = 2 * l - q;
            r = hue2rgb(p, q, h + 1 / 3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1 / 3);
        }
        return {
            r: Math.round(r * 255),
            g: Math.round(g * 255),
            b: Math.round(b * 255),
        };
    }
    hslaToRgb(hsla) {
        if (!hsla)
            throw new TypeError(`Invalid argument; has no value.`);
        const match = hsla.match(/^hsla\(\s*((\d{1,2}|[1-2]\d{2}|3[0-5]\d)|360)\s*,\s*(\d{1,2}|100)%\s*,\s*(\d{1,2}|100)%\s*,\s*(0(\.\d+)?|1(\.0)?)\s*\)$/);
        if (!match)
            throw new TypeError(`Invalid HSLA color format: ${hsla}`);
        const h = parseInt(match[1]) / 360;
        const s = parseInt(match[2]) / 100;
        const l = parseInt(match[3]) / 100;
        let r, g, b;
        if (s === 0) {
            r = g = b = l; // Achromatic
        }
        else {
            const hue2rgb = (p, q, t) => {
                if (t < 0)
                    t += 1;
                if (t > 1)
                    t -= 1;
                if (t < 1 / 6)
                    return p + (q - p) * 6 * t;
                if (t < 1 / 2)
                    return q;
                if (t < 2 / 3)
                    return p + (q - p) * (2 / 3 - t) * 6;
                return p;
            };
            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            const p = 2 * l - q;
            r = hue2rgb(p, q, h + 1 / 3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1 / 3);
        }
        return {
            r: Math.round(r * 255),
            g: Math.round(g * 255),
            b: Math.round(b * 255),
        };
    }
    //------------- END -------------
    //------------- TO HSL -------------
    hexToHsl(hex) {
        const r = parseInt(hex.substring(1, 3), 16) / 255;
        const g = parseInt(hex.substring(3, 5), 16) / 255;
        const b = parseInt(hex.substring(5, 7), 16) / 255;
        const min = Math.min(r, g, b);
        const max = Math.max(r, g, b);
        const l = (min + max) / 2;
        let s = 0;
        if (min !== max) {
            s = l > 0.5 ? (max - min) / (2 - max - min) : (max - min) / (max + min);
        }
        let h = 0;
        if (min !== max) {
            if (max === r) {
                h = (g - b) / (max - min);
            }
            else if (max === g) {
                h = 2 + (b - r) / (max - min);
            }
            else {
                h = 4 + (r - g) / (max - min);
            }
        }
        h *= 60;
        if (h < 0) {
            h += 360;
        }
        return { h, s: s * 100, l: l * 100 };
    }
    //------------- END -------------
    //------------- TO HEX -------------
    rgbToHex(rgbString) {
        const rgbMatch = rgbString.match(/^rgb\(\s*(0*(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*,\s*(0*(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*,\s*(0*(?:[0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*\)$/);
        if (!rgbMatch) {
            throw new Error('Incorrect RGB color format.');
        }
        const [, r, g, b] = rgbMatch.map(Number);
        return `#${r.toString(16).padStart(2, '0')}${g
            .toString(16)
            .padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
    }
    nameSVGToHex(name) {
        const response = PresetColors[name.toLowerCase()];
        if (response) {
            return PresetColors[name.toLowerCase()];
        }
        throw new Error('Wrong color name');
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: ColorConverter, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: ColorConverter, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: ColorConverter, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return []; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3ItY29udmVydGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9uZ3gtZWFnbGUvY29yZS9zZXJ2aWNlcy9jb2xvci1jb252ZXJ0ZXIvY29sb3ItY29udmVydGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxQyxPQUFPLEVBQTJCLFlBQVksRUFBRSxNQUFNLHNCQUFzQixDQUFDOztBQUs3RSxNQUFNLE9BQU8sY0FBYztJQUN6QixnQkFBZSxDQUFDO0lBRWhCLG9EQUFvRDtJQUU3QyxjQUFjLENBQUMsWUFBb0I7UUFDeEMsSUFBSSxDQUFDLFlBQVk7WUFBRSxNQUFNLElBQUksU0FBUyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7UUFDMUUsWUFBWSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sWUFBWSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUNqRSxDQUFDO0lBRU0sS0FBSyxDQUFDLEdBQVc7UUFDdEIsSUFBSSxDQUFDLEdBQUc7WUFBRSxNQUFNLElBQUksU0FBUyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7UUFDakUsTUFBTSxLQUFLLEdBQUcsNEJBQTRCLENBQUM7UUFDM0MsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFTSxLQUFLLENBQUMsR0FBVztRQUN0QixJQUFJLENBQUMsR0FBRztZQUFFLE1BQU0sSUFBSSxTQUFTLENBQUMsaUNBQWlDLENBQUMsQ0FBQztRQUNqRSxNQUFNLEtBQUssR0FDVCwrS0FBK0ssQ0FBQztRQUNsTCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDekIsQ0FB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QUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQzthQUMzQyxRQUFRLENBQUMsRUFBRSxDQUFDO2FBQ1osUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQztJQUMxRCxDQUFDO0lBRUQsWUFBWSxDQUFDLElBQVM7UUFDcEIsTUFBTSxRQUFRLEdBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO1FBQ2xELElBQUksUUFBUSxFQUFFO1lBQ1osT0FBTyxZQUFZLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7U0FDekM7UUFDRCxNQUFNLElBQUksS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDdEMsQ0FBQzsrR0F0UVUsY0FBYzttSEFBZCxjQUFjLGNBRmIsTUFBTTs7NEZBRVAsY0FBYztrQkFIMUIsVUFBVTttQkFBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQ29sb3JDb250cmFzdCwgSFNMLCBSR0IsIFByZXNldENvbG9ycyB9IGZyb20gJ25neC1lYWdsZS9jb3JlL3R5cGVzJztcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCcsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb2xvckNvbnZlcnRlciB7XHJcbiAgY29uc3RydWN0b3IoKSB7fVxyXG5cclxuICAvLy0tLS0tLS0tLS0tLS0tU1RBUlQgVkFMSURBVElPTlMgLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIHB1YmxpYyBpc1ByZXNldENvbG9ycyhwcmVzZXRDb2xvcnM6IHN0cmluZykge1xyXG4gICAgaWYgKCFwcmVzZXRDb2xvcnMpIHRocm93IG5ldyBUeXBlRXJyb3IoYEludmFsaWQgYXJndW1lbnQ7IGhhcyBubyB2YWx1ZS5gKTtcclxuICAgIFByZXNldENvbG9yc1twcmVzZXRDb2xvcnMudG9Mb3dlckNhc2UoKV07XHJcbiAgICByZXR1cm4gUHJlc2V0Q29sb3JzW3ByZXNldENvbG9ycy50b0xvd2VyQ2FzZSgpXSA/IHRydWUgOiBmYWxzZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc0hleChoZXg6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCFoZXgpIHRocm93IG5ldyBUeXBlRXJyb3IoYEludmFsaWQgYXJndW1lbnQ7IGhhcyBubyB2YWx1ZS5gKTtcclxuICAgIGNvbnN0IHJlZ2V4ID0gL14jKD86WzAtOWEtZkEtRl17M30pezEsMn0kLztcclxuICAgIHJldHVybiByZWdleC50ZXN0KGhleCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNSR0IocmdiOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGlmICghcmdiKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIGFyZ3VtZW50OyBoYXMgbm8gdmFsdWUuYCk7XHJcbiAgICBjb25zdCByZWdleCA9XHJcbiAgICAgIC9ecmdiXFwoXFxzKigwKig/OlswLTldezEsMn18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pKVxccyosXFxzKigwKig/OlswLTldezEsMn18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pKVxccyosXFxzKigwKig/OlswLTldezEsMn18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pKVxccypcXCkkLztcclxuICAgIHJldHVybiByZWdleC50ZXN0KHJnYik7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNSR0JBKHJnYmE6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCFyZ2JhKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIGFyZ3VtZW50OyBoYXMgbm8gdmFsdWUuYCk7XHJcbiAgICBjb25zdCByZWdleCA9XHJcbiAgICAgIC9ecmdiYVxcKFxccyooKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPyl8MClcXHMqLFxccyooKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPyl8MClcXHMqLFxccyooKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPyl8MClcXHMqLFxccyooKDEoXFwuMCk/KXwwKFxcLlxcZCspPylcXHMqXFwpJC87XHJcbiAgICByZXR1cm4gcmVnZXgudGVzdChyZ2JhKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc0hTTChoc2w6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCFoc2wpIHRocm93IG5ldyBUeXBlRXJyb3IoYEludmFsaWQgYXJndW1lbnQ7IGhhcyBubyB2YWx1ZS5gKTtcclxuICAgIGNvbnN0IHJlZ2V4ID1cclxuICAgICAgL15oc2xcXChcXHMqKChcXGR7MSwyfXxbMS0yXVxcZHsyfXwzWzAtNV1cXGQpfDM2MClcXHMqLFxccyooXFxkezEsMn18MTAwKSVcXHMqLFxccyooXFxkezEsMn18MTAwKSVcXHMqXFwpJC87XHJcbiAgICByZXR1cm4gcmVnZXgudGVzdChoc2wpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzSFNMQShoc2xhOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIGlmICghaHNsYSkgdGhyb3cgbmV3IFR5cGVFcnJvcihgSW52YWxpZCBhcmd1bWVudDsgaGFzIG5vIHZhbHVlLmApO1xyXG4gICAgY29uc3QgcmVnZXggPVxyXG4gICAgICAvXmhzbGFcXChcXHMqKChcXGR7MSwyfXxbMS0yXVxcZHsyfXwzWzAtNV1cXGQpfDM2MClcXHMqLFxccyooXFxkezEsMn18MTAwKSVcXHMqLFxccyooXFxkezEsMn18MTAwKSVcXHMqLFxccyooMChcXC5cXGQrKT98MShcXC4wKT8pXFxzKlxcKSQvO1xyXG4gICAgcmV0dXJuIHJlZ2V4LnRlc3QoaHNsYSk7XHJcbiAgfVxyXG4gIC8vLS0tLS0tLS0tLS0tLS1FTkQgVkFMSURBVElPTlMgLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIGNvbnRyYXN0aW5nQ29sb3JzKGNvbG9yOiBzdHJpbmcpOiBDb2xvckNvbnRyYXN0IHtcclxuICAgIGxldCByZ2I6IFJHQjtcclxuXHJcbiAgICBpZiAodGhpcy5pc1ByZXNldENvbG9ycyhjb2xvcikpIHtcclxuICAgICAgcmdiID0gdGhpcy5oZXhUb1JnYih0aGlzLm5hbWVTVkdUb0hleChjb2xvcikpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmlzSGV4KGNvbG9yKSkge1xyXG4gICAgICByZ2IgPSB0aGlzLmhleFRvUmdiKGNvbG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5pc1JHQihjb2xvcikpIHtcclxuICAgICAgcmdiID0gdGhpcy5yZ2JUb09iamVjdChjb2xvcik7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuaXNSR0JBKGNvbG9yKSkge1xyXG4gICAgICByZ2IgPSB0aGlzLnJnYmFUb09iamVjdChjb2xvcik7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuaXNIU0woY29sb3IpKSB7XHJcbiAgICAgIHJnYiA9IHRoaXMuaHNsVG9SZ2IoY29sb3IpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuaXNIU0xBKGNvbG9yKSkge1xyXG4gICAgICByZ2IgPSB0aGlzLmhzbGFUb1JnYihjb2xvcik7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYnVpbGRPdmVybGF5Q29sb3IgPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGx1bWluYW5jZSA9IHRoaXMubHVtaW5hbmNlKHJnYik7XHJcbiAgICAgIHJldHVybiBsdW1pbmFuY2UgPiAwLjUgPyB0aGlzLmNoYW5nZVJnYkx1bWluYW5jZShyZ2IsIDAuMzUpIDogJyNmZmZmZmYnO1xyXG4gICAgfTtcclxuICAgIGNvbnN0IGJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xyXG4gICAgY29uc3Qgb3ZlcmxheUNvbG9yID0gYnVpbGRPdmVybGF5Q29sb3IoKTtcclxuICAgIHJldHVybiB7IGJhY2tncm91bmRDb2xvcjogYmFja2dyb3VuZENvbG9yLCBvdmVybGF5Q29sb3I6IG92ZXJsYXlDb2xvciB9O1xyXG4gIH1cclxuXHJcbiAgY2hhbmdlUmdiTHVtaW5hbmNlKHJnYjogUkdCLCBsdW1pbmFuY2U6IG51bWJlcik6IHN0cmluZyB7XHJcbiAgICBjb25zdCBuZXdSID0gTWF0aC5tYXgoMCwgTWF0aC5mbG9vcihyZ2IuciAqIGx1bWluYW5jZSkpO1xyXG4gICAgY29uc3QgbmV3RyA9IE1hdGgubWF4KDAsIE1hdGguZmxvb3IocmdiLmcgKiBsdW1pbmFuY2UpKTtcclxuICAgIGNvbnN0IG5ld0IgPSBNYXRoLm1heCgwLCBNYXRoLmZsb29yKHJnYi5iICogbHVtaW5hbmNlKSk7XHJcbiAgICByZXR1cm4gYHJnYigke25ld1J9LCR7bmV3R30sJHtuZXdCfSlgO1xyXG4gIH1cclxuXHJcbiAgbHVtaW5hbmNlKGNvbG9yOiBSR0IpIHtcclxuICAgIHJldHVybiAoMC4yOTkgKiBjb2xvci5yICsgMC41ODcgKiBjb2xvci5nICsgMC4xMTQgKiBjb2xvci5iKSAvIDI1NTtcclxuICB9XHJcblxyXG4gIC8vLS0tLS0tLS0tLS0tLSBUTyBSR0IgLS0tLS0tLS0tLS0tLVxyXG4gIHJnYlRvT2JqZWN0KHJnYjogc3RyaW5nKTogUkdCIHtcclxuICAgIGlmICghcmdiKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIGFyZ3VtZW50OyBoYXMgbm8gdmFsdWUuYCk7XHJcbiAgICBjb25zdCBtYXRjaCA9IHJnYi5tYXRjaChcclxuICAgICAgL15yZ2JcXChcXHMqKDAqKD86WzAtOV17MSwyfXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSkpXFxzKixcXHMqKDAqKD86WzAtOV17MSwyfXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSkpXFxzKixcXHMqKDAqKD86WzAtOV17MSwyfXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSkpXFxzKlxcKSQvXHJcbiAgICApO1xyXG4gICAgaWYgKCFtYXRjaCkgdGhyb3cgbmV3IFR5cGVFcnJvcihgSW52YWxpZCBSR0IgY29sb3IgZm9ybWF0OiAke3JnYn1gKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICByOiBwYXJzZUludChtYXRjaFsxXSksXHJcbiAgICAgIGc6IHBhcnNlSW50KG1hdGNoWzJdKSxcclxuICAgICAgYjogcGFyc2VJbnQobWF0Y2hbM10pLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHJnYmFUb09iamVjdChyZ2JhOiBzdHJpbmcpOiBSR0Ige1xyXG4gICAgaWYgKCFyZ2JhKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIGFyZ3VtZW50OyBoYXMgbm8gdmFsdWUuYCk7XHJcbiAgICBjb25zdCBtYXRjaCA9IHJnYmEubWF0Y2goXHJcbiAgICAgIC9ecmdiYVxcKFxccyooKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPyl8MClcXHMqLFxccyooKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPyl8MClcXHMqLFxccyooKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPyl8MClcXHMqLFxccyooKDEoXFwuMCk/KXwwKFxcLlxcZCspPylcXHMqXFwpJC9cclxuICAgICk7XHJcbiAgICBpZiAoIW1hdGNoKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIFJHQkEgY29sb3IgZm9ybWF0OiAke3JnYmF9YCk7XHJcblxyXG4gICAgY29uc3QgciA9IHBhcnNlSW50KG1hdGNoWzFdKTtcclxuICAgIGNvbnN0IGcgPSBwYXJzZUludChtYXRjaFszXSk7XHJcbiAgICBjb25zdCBiID0gcGFyc2VJbnQobWF0Y2hbNV0pO1xyXG4gICAgY29uc3QgYSA9IHBhcnNlRmxvYXQobWF0Y2hbN10pO1xyXG5cclxuICAgIC8vIENvbnZlcnRpciBlbCBjb2xvciBjb24gb3BhY2lkYWQgYSBSR0JcclxuICAgIGNvbnN0IHJnYiA9IHtcclxuICAgICAgcjogTWF0aC5yb3VuZCgoMSAtIGEpICogMjU1ICsgYSAqIHIpLFxyXG4gICAgICBnOiBNYXRoLnJvdW5kKCgxIC0gYSkgKiAyNTUgKyBhICogZyksXHJcbiAgICAgIGI6IE1hdGgucm91bmQoKDEgLSBhKSAqIDI1NSArIGEgKiBiKSxcclxuICAgIH07XHJcbiAgICByZXR1cm4gcmdiO1xyXG4gIH1cclxuXHJcbiAgaGV4VG9SZ2IoaGV4OiBzdHJpbmcpOiBSR0Ige1xyXG4gICAgbGV0IGhleENvZGUgPSBoZXguc3RhcnRzV2l0aCgnIycpID8gaGV4LnNsaWNlKDEpIDogaGV4O1xyXG4gICAgaWYgKGhleENvZGUubGVuZ3RoID09PSAzKSB7XHJcbiAgICAgIGhleENvZGUgPSBoZXhDb2RlXHJcbiAgICAgICAgLnNwbGl0KCcnKVxyXG4gICAgICAgIC5tYXAoKGNoYXIpID0+IGNoYXIgKyBjaGFyKVxyXG4gICAgICAgIC5qb2luKCcnKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGJpZ2ludCA9IHBhcnNlSW50KGhleENvZGUsIDE2KTtcclxuICAgIGNvbnN0IHIgPSAoYmlnaW50ID4+IDE2KSAmIDI1NTtcclxuICAgIGNvbnN0IGcgPSAoYmlnaW50ID4+IDgpICYgMjU1O1xyXG4gICAgY29uc3QgYiA9IGJpZ2ludCAmIDI1NTtcclxuICAgIHJldHVybiB7IHIsIGcsIGIgfTtcclxuICB9XHJcblxyXG4gIGhzbFRvUmdiKGhzbDogc3RyaW5nKTogUkdCIHtcclxuICAgIGlmICghaHNsKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIGFyZ3VtZW50OyBoYXMgbm8gdmFsdWUuYCk7XHJcbiAgICBjb25zdCBtYXRjaCA9IGhzbC5tYXRjaCgvXmhzbFxcKFxccyooXFxkKylcXHMqLFxccyooXFxkKyklXFxzKixcXHMqKFxcZCspJVxccypcXCkkLyk7XHJcbiAgICBpZiAoIW1hdGNoKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIEhTTCBjb2xvciBmb3JtYXQ6ICR7aHNsfWApO1xyXG5cclxuICAgIGNvbnN0IGggPSBwYXJzZUludChtYXRjaFsxXSkgLyAzNjA7XHJcbiAgICBjb25zdCBzID0gcGFyc2VJbnQobWF0Y2hbMl0pIC8gMTAwO1xyXG4gICAgY29uc3QgbCA9IHBhcnNlSW50KG1hdGNoWzNdKSAvIDEwMDtcclxuXHJcbiAgICBsZXQgciwgZywgYjtcclxuICAgIGlmIChzID09PSAwKSB7XHJcbiAgICAgIHIgPSBnID0gYiA9IGw7IC8vIEFjaHJvbWF0aWNcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGh1ZTJyZ2IgPSAocDogbnVtYmVyLCBxOiBudW1iZXIsIHQ6IG51bWJlcikgPT4ge1xyXG4gICAgICAgIGlmICh0IDwgMCkgdCArPSAxO1xyXG4gICAgICAgIGlmICh0ID4gMSkgdCAtPSAxO1xyXG4gICAgICAgIGlmICh0IDwgMSAvIDYpIHJldHVybiBwICsgKHEgLSBwKSAqIDYgKiB0O1xyXG4gICAgICAgIGlmICh0IDwgMSAvIDIpIHJldHVybiBxO1xyXG4gICAgICAgIGlmICh0IDwgMiAvIDMpIHJldHVybiBwICsgKHEgLSBwKSAqICgyIC8gMyAtIHQpICogNjtcclxuICAgICAgICByZXR1cm4gcDtcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcSA9IGwgPCAwLjUgPyBsICogKDEgKyBzKSA6IGwgKyBzIC0gbCAqIHM7XHJcbiAgICAgIGNvbnN0IHAgPSAyICogbCAtIHE7XHJcbiAgICAgIHIgPSBodWUycmdiKHAsIHEsIGggKyAxIC8gMyk7XHJcbiAgICAgIGcgPSBodWUycmdiKHAsIHEsIGgpO1xyXG4gICAgICBiID0gaHVlMnJnYihwLCBxLCBoIC0gMSAvIDMpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHI6IE1hdGgucm91bmQociAqIDI1NSksXHJcbiAgICAgIGc6IE1hdGgucm91bmQoZyAqIDI1NSksXHJcbiAgICAgIGI6IE1hdGgucm91bmQoYiAqIDI1NSksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgaHNsYVRvUmdiKGhzbGE6IHN0cmluZyk6IFJHQiB7XHJcbiAgICBpZiAoIWhzbGEpIHRocm93IG5ldyBUeXBlRXJyb3IoYEludmFsaWQgYXJndW1lbnQ7IGhhcyBubyB2YWx1ZS5gKTtcclxuICAgIGNvbnN0IG1hdGNoID0gaHNsYS5tYXRjaChcclxuICAgICAgL15oc2xhXFwoXFxzKigoXFxkezEsMn18WzEtMl1cXGR7Mn18M1swLTVdXFxkKXwzNjApXFxzKixcXHMqKFxcZHsxLDJ9fDEwMCklXFxzKixcXHMqKFxcZHsxLDJ9fDEwMCklXFxzKixcXHMqKDAoXFwuXFxkKyk/fDEoXFwuMCk/KVxccypcXCkkL1xyXG4gICAgKTtcclxuICAgIGlmICghbWF0Y2gpIHRocm93IG5ldyBUeXBlRXJyb3IoYEludmFsaWQgSFNMQSBjb2xvciBmb3JtYXQ6ICR7aHNsYX1gKTtcclxuICAgIGNvbnN0IGggPSBwYXJzZUludChtYXRjaFsxXSkgLyAzNjA7XHJcbiAgICBjb25zdCBzID0gcGFyc2VJbnQobWF0Y2hbMl0pIC8gMTAwO1xyXG4gICAgY29uc3QgbCA9IHBhcnNlSW50KG1hdGNoWzNdKSAvIDEwMDtcclxuICAgIGxldCByLCBnLCBiO1xyXG4gICAgaWYgKHMgPT09IDApIHtcclxuICAgICAgciA9IGcgPSBiID0gbDsgLy8gQWNocm9tYXRpY1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgaHVlMnJnYiA9IChwOiBudW1iZXIsIHE6IG51bWJlciwgdDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgaWYgKHQgPCAwKSB0ICs9IDE7XHJcbiAgICAgICAgaWYgKHQgPiAxKSB0IC09IDE7XHJcbiAgICAgICAgaWYgKHQgPCAxIC8gNikgcmV0dXJuIHAgKyAocSAtIHApICogNiAqIHQ7XHJcbiAgICAgICAgaWYgKHQgPCAxIC8gMikgcmV0dXJuIHE7XHJcbiAgICAgICAgaWYgKHQgPCAyIC8gMykgcmV0dXJuIHAgKyAocSAtIHApICogKDIgLyAzIC0gdCkgKiA2O1xyXG4gICAgICAgIHJldHVybiBwO1xyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBxID0gbCA8IDAuNSA/IGwgKiAoMSArIHMpIDogbCArIHMgLSBsICogcztcclxuICAgICAgY29uc3QgcCA9IDIgKiBsIC0gcTtcclxuICAgICAgciA9IGh1ZTJyZ2IocCwgcSwgaCArIDEgLyAzKTtcclxuICAgICAgZyA9IGh1ZTJyZ2IocCwgcSwgaCk7XHJcbiAgICAgIGIgPSBodWUycmdiKHAsIHEsIGggLSAxIC8gMyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICByOiBNYXRoLnJvdW5kKHIgKiAyNTUpLFxyXG4gICAgICBnOiBNYXRoLnJvdW5kKGcgKiAyNTUpLFxyXG4gICAgICBiOiBNYXRoLnJvdW5kKGIgKiAyNTUpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vLS0tLS0tLS0tLS0tLSBFTkQgLS0tLS0tLS0tLS0tLVxyXG4gIC8vLS0tLS0tLS0tLS0tLSBUTyBIU0wgLS0tLS0tLS0tLS0tLVxyXG4gIGhleFRvSHNsKGhleDogc3RyaW5nKTogSFNMIHtcclxuICAgIGNvbnN0IHIgPSBwYXJzZUludChoZXguc3Vic3RyaW5nKDEsIDMpLCAxNikgLyAyNTU7XHJcbiAgICBjb25zdCBnID0gcGFyc2VJbnQoaGV4LnN1YnN0cmluZygzLCA1KSwgMTYpIC8gMjU1O1xyXG4gICAgY29uc3QgYiA9IHBhcnNlSW50KGhleC5zdWJzdHJpbmcoNSwgNyksIDE2KSAvIDI1NTtcclxuICAgIGNvbnN0IG1pbiA9IE1hdGgubWluKHIsIGcsIGIpO1xyXG4gICAgY29uc3QgbWF4ID0gTWF0aC5tYXgociwgZywgYik7XHJcbiAgICBjb25zdCBsID0gKG1pbiArIG1heCkgLyAyO1xyXG4gICAgbGV0IHMgPSAwO1xyXG4gICAgaWYgKG1pbiAhPT0gbWF4KSB7XHJcbiAgICAgIHMgPSBsID4gMC41ID8gKG1heCAtIG1pbikgLyAoMiAtIG1heCAtIG1pbikgOiAobWF4IC0gbWluKSAvIChtYXggKyBtaW4pO1xyXG4gICAgfVxyXG4gICAgbGV0IGggPSAwO1xyXG4gICAgaWYgKG1pbiAhPT0gbWF4KSB7XHJcbiAgICAgIGlmIChtYXggPT09IHIpIHtcclxuICAgICAgICBoID0gKGcgLSBiKSAvIChtYXggLSBtaW4pO1xyXG4gICAgICB9IGVsc2UgaWYgKG1heCA9PT0gZykge1xyXG4gICAgICAgIGggPSAyICsgKGIgLSByKSAvIChtYXggLSBtaW4pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGggPSA0ICsgKHIgLSBnKSAvIChtYXggLSBtaW4pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBoICo9IDYwO1xyXG4gICAgaWYgKGggPCAwKSB7XHJcbiAgICAgIGggKz0gMzYwO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHsgaCwgczogcyAqIDEwMCwgbDogbCAqIDEwMCB9O1xyXG4gIH1cclxuICAvLy0tLS0tLS0tLS0tLS0gRU5EIC0tLS0tLS0tLS0tLS1cclxuICAvLy0tLS0tLS0tLS0tLS0gVE8gSEVYIC0tLS0tLS0tLS0tLS1cclxuICByZ2JUb0hleChyZ2JTdHJpbmc6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBjb25zdCByZ2JNYXRjaCA9IHJnYlN0cmluZy5tYXRjaChcclxuICAgICAgL15yZ2JcXChcXHMqKDAqKD86WzAtOV17MSwyfXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSkpXFxzKixcXHMqKDAqKD86WzAtOV17MSwyfXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSkpXFxzKixcXHMqKDAqKD86WzAtOV17MSwyfXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSkpXFxzKlxcKSQvXHJcbiAgICApO1xyXG4gICAgaWYgKCFyZ2JNYXRjaCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0luY29ycmVjdCBSR0IgY29sb3IgZm9ybWF0LicpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgWywgciwgZywgYl0gPSByZ2JNYXRjaC5tYXAoTnVtYmVyKTtcclxuICAgIHJldHVybiBgIyR7ci50b1N0cmluZygxNikucGFkU3RhcnQoMiwgJzAnKX0ke2dcclxuICAgICAgLnRvU3RyaW5nKDE2KVxyXG4gICAgICAucGFkU3RhcnQoMiwgJzAnKX0ke2IudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICcwJyl9YDtcclxuICB9XHJcblxyXG4gIG5hbWVTVkdUb0hleChuYW1lOiBhbnkpIHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gUHJlc2V0Q29sb3JzW25hbWUudG9Mb3dlckNhc2UoKV07XHJcbiAgICBpZiAocmVzcG9uc2UpIHtcclxuICAgICAgcmV0dXJuIFByZXNldENvbG9yc1tuYW1lLnRvTG93ZXJDYXNlKCldO1xyXG4gICAgfVxyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdXcm9uZyBjb2xvciBuYW1lJyk7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=